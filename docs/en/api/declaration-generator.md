# Declaration Generator

The Declaration Generator module is responsible for creating and managing the TypeScript declaration files required for auto-import functionality. It provides functions to generate placeholder declaration files that will be automatically updated by the auto-import plugins during development.

## API Reference

### `generateDeclarationFiles`

**Signature:**

```typescript
function generateDeclarationFiles(
  options: GenerateDeclarationFilesOptions
): Promise<GenerateDeclarationFilesResult>;
```

**Parameters:**

- `options: GenerateDeclarationFilesOptions` - Configuration options for declaration file generation
  - `path?: string` - The path to the project directory (defaults to current directory)

**Returns:**

- `Promise<GenerateDeclarationFilesResult>` - A promise that resolves to the generation result
  - `success: boolean` - Whether the generation was successful
  - `componentsDeclarationPath: string` - The path to the components declaration file
  - `autoImportsDeclarationPath: string` - The path to the auto-imports declaration file
  - `filesCreated: boolean` - Whether new files were created or existing files were preserved

**Example:**

```typescript
import { generateDeclarationFiles } from "ew-auto-import-tool";

async function setupDeclarations() {
  try {
    const result = await generateDeclarationFiles({
      path: "./my-vue-project",
    });

    if (result.success) {
      console.log("Declaration files generated successfully:");
      console.log(`Components: ${result.componentsDeclarationPath}`);
      console.log(`Auto-imports: ${result.autoImportsDeclarationPath}`);

      if (result.filesCreated) {
        console.log("New declaration files were created");
      } else {
        console.log("Existing declaration files were preserved");
      }
    } else {
      console.error("Failed to generate declaration files");
    }
  } catch (error) {
    console.error("Error generating declaration files:", error);
  }
}

setupDeclarations();
```

## Implementation Details

The Declaration Generator performs the following operations:

1. **File Path Resolution**

   - Determines the paths for the declaration files
   - By default, creates files in the project root directory

2. **File Existence Check**

   - Checks if declaration files already exist
   - Preserves existing files to avoid overwriting user modifications

3. **Template Generation**
   - Creates placeholder declaration files with minimal content
   - These files will be automatically updated by the plugins during development

## Declaration File Templates

The module generates two declaration files:

### components.d.ts

```typescript
/* eslint-disable */
/* prettier-ignore */
// @ts-nocheck
// Generated by unplugin-vue-components
// Read more: https://github.com/vuejs/core/pull/3399
import '@vue/runtime-core'

export {};

declare module "@vue/runtime-core" {
  export interface GlobalComponents {
    // This will be filled automatically by the plugin
  }
}
```

### auto-imports.d.ts

```typescript
/* eslint-disable */
/* prettier-ignore */
// @ts-nocheck
// Generated by unplugin-auto-import
export {}
declare global {
  // This will be filled automatically by the plugin
}
```

## Source Code Analysis

The Declaration Generator uses the file system to create declaration files. It follows these steps:

1. Determine the paths for the declaration files
2. Check if the files already exist
3. If they don't exist, create them with placeholder content
4. Return the paths and creation status

```typescript
// Simplified implementation
async function generateDeclarationFiles(
  options: GenerateDeclarationFilesOptions
): Promise<GenerateDeclarationFilesResult> {
  const projectPath = options.path || process.cwd();

  // Determine file paths
  const componentsDeclarationPath = path.join(projectPath, "components.d.ts");
  const autoImportsDeclarationPath = path.join(
    projectPath,
    "auto-imports.d.ts"
  );

  // Check if files already exist
  const componentsExists = fs.existsSync(componentsDeclarationPath);
  const autoImportsExists = fs.existsSync(autoImportsDeclarationPath);

  let filesCreated = false;

  // Create components declaration file if it doesn't exist
  if (!componentsExists) {
    const componentsTemplate = `/* eslint-disable */
/* prettier-ignore */
// @ts-nocheck
// Generated by unplugin-vue-components
// Read more: https://github.com/vuejs/core/pull/3399
import '@vue/runtime-core'

export {}

declare module '@vue/runtime-core' {
  export interface GlobalComponents {
    // This will be filled automatically by the plugin
  }
}`;

    fs.writeFileSync(componentsDeclarationPath, componentsTemplate, "utf-8");
    filesCreated = true;
  }

  // Create auto-imports declaration file if it doesn't exist
  if (!autoImportsExists) {
    const autoImportsTemplate = `/* eslint-disable */
/* prettier-ignore */
// @ts-nocheck
// Generated by unplugin-auto-import
export {}
declare global {
  // This will be filled automatically by the plugin
}`;

    fs.writeFileSync(autoImportsDeclarationPath, autoImportsTemplate, "utf-8");
    filesCreated = true;
  }

  return {
    success: true,
    componentsDeclarationPath,
    autoImportsDeclarationPath,
    filesCreated,
  };
}
```

## Error Handling

The Declaration Generator includes robust error handling to provide clear feedback when issues are encountered:

- File system access errors
- Permission issues when creating files
- Path resolution errors

These errors are propagated to the caller with descriptive messages to help users troubleshoot issues.

## Related Modules

- [TypeScript Config Manager](./ts-config-manager.md) - Updates the TypeScript configuration to include the declaration files
- [Vite Config Manager](./vite-config-manager.md) - Configures the plugins that will update the declaration files
